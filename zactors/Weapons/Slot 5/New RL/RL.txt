CLASS NewRl : RocketLauncher replaces rocketlauncher
{
int ShotType;
	default
	{
	Weapon.SelectionOrder 2500;
	Weapon.AmmoUse 1;
	Weapon.AmmoGive 10;
	Weapon.SlotNumber 5;
	Weapon.SlotPriority 0;
	Weapon.AmmoType "RocketAmmo";
	Weapon.UpSound "weapons/AnnIn";
	+WEAPON.NOAUTOFIRE;
	Inventory.PickupMessage "You got the UAC RPG Launcher MK2!";
	Tag "$TAG_ROCKETLAUNCHER";
	}
	States
	{
	Ready:
	MMK2 A 1 A_WeaponReady(WRF_ALLOWRELOAD|WRF_ALLOWUSER1|WRF_ALLOWUSER2);
	Loop;
	Deselect:
		TNT1 A 0
    	  {
			if(CountInv("AnnAmmo") ==  0)
            {
				ACS_NamedExecute("OutOfRockets");
                return ResolveState (null);
            }
            else 
			{
			    return ResolveState(null);
			}
           }
		  NRL4 A 1 A_Lower(12);
		  Loop;
	MMK2 A 1 A_Lower(12);
	Loop;
	Select:
	MMK2 A 1 A_Raise(12);
	Loop;
	User1:
	TNT1 A 0
	{
			if(Invoker.ShotType == 4)           //If the shot type variable is equal to three
			{
				invoker.ShotType = 0;               //reset ShotType to 0 (Buckshot)
				return ResolveState("RkMsgState");    //Go to ammo switch message switch block
			} 
			else if (invoker.ShotType != 4)     //Otherwise if shot type is not equal to three
			{
				invoker.ShotType++;                  //Incriment shot type variable by one
				return ResolveState("RkMsgState");     //Go to ammo switch message switch block
			}
			else 
			{
				return ResolveState(null); 
			}
        }
   
    //Firemode Switch Key 2
    User2:
      TNT1 A 0
		{
			if(Invoker.ShotType == 0)           //If the shot type variable is equal to zero
			{
				invoker.ShotType = 4;               //reset ShotType to 3 (Frag-12)
				return ResolveState("RkMsgState");    //Go to ammo switch message switch block
			} 
			else if (Invoker.ShotType != 0)     //otherwise if shot type is not equal to zero
			{   
				invoker.ShotType--;                  //decriment shot type by one
				return ResolveState("RkMsgState");    //Go to ammo switch message switch block
			}
			else
			{
				return ResolveState(null);
			}    
		}
		
	 RkMsgState:
        TNT1 A 0
        {
         switch(invoker.ShotType)
            {
                case 0: ACS_Execute(3655);              //Play Normal Rocket message
                break;                                  //Break out of the switch block

                case 1: ACS_Execute(3656);              //Play Homing Rocket message
                break;                                  //Break out of the switch block

                case 2: ACS_Execute(3657);              //Play Grenade message
                break;                                  //Break out of the switch block

                case 3: ACS_Execute(3658);              //Play Hornet's Hive message
                break;                                  //Break out of the switch block
				
                case 4: ACS_Execute(3660);              //Play QuadShot message
                break;                                  //Break out of the switch block
            }    
		}
	goto FireSwitch; 		
	
	FireSwitch:
		MMK2 A 3;
		MMKS A 3;
		MMKS B 3 A_PlaySound("Weapons/arswitch", chan_auto);
		MMKS A 3;
		MMK2 A 3;
		goto ready;
	
	Fire:
	MMK2 E 8 A_GunFlash;
	MMK2 E 12
	{
	Switch(Invoker.ShotType)
	  {
		Case 0:
			A_FireProjectile("AnnRocket",0 , 1, 0, -1);
			A_StartSound("Weapons/ANNFire",0);
			break;
		Case 1:
			A_FireProjectile("AnnHornet",0 , 1, 0, -1);
			A_StartSound("Weapons/ANNFire",0);
			break;
		Case 2: 
			A_FireProjectile("AnnGrenade",0 , 1, 0, -1);
			A_StartSound("Weapons/ANNFire",0);
			break;
		Case 3: 
			A_FireProjectile("HornetHive",0 , 4, 0, -1);
			A_StartSound("Weapons/ANNFire",0);
			break;			
		Case 4: 
			A_FireProjectile("MagnusCluster",0 , 1, 0, -1);
			A_StartSound("Weapons/ANNFire",0);
			break;
		Default:
			break;
		}
	}
	MMK2 E 0 A_ReFire;
	Goto Ready;
	Flash:
	MMKF A 3 Bright A_Light1;
	MMKF B 4 Bright;
	MMKF CD 4 Bright A_Light2;
	Goto LightDone;
	Spawn:
	LAUN A -1;
	Stop;
	}
}
